# 系统架构

## 系统总体架构

本16X16乘法器采用了模块化的设计思想，将整个系统分为多个功能明确的子模块，通过子模块间的有效连接实现完整的乘法计算功能。系统的总体架构如下图所示：

![系统设计框图](./readme_pic/systemdesign.png)

整个乘法器由以下几个核心模块组成：

1. **Booth编码模块**（Booth_Classic）：负责生成部分积
2. **Wallace树模块**（WallaceTree16X16）：负责压缩部分积
3. **平方根进位选择加法器模块**（CS_Adder32）：负责最终的加法操作
4. **顶层控制模块**（TopMultiplier）：负责整合各个子模块并完成整体功能

此外，系统还包含基础的半加器（HalfAdder）和全加器（FullAdder）模块作为基本计算单元。

## 数据流设计

系统的数据流设计遵循乘法运算的自然步骤，包括部分积生成、部分积压缩以及最终求和三个主要过程。

### 输入输出规格

- **输入**：两个16位有符号数（补码表示）
  - x_in[15:0]：被乘数
  - y_in[15:0]：乘数
- **输出**：一个32位有符号数（补码表示）
  - result_out[31:0]：乘法结果

### 数据流过程

1. **部分积生成阶段**：
   - 将16位乘数和16位被乘数输入到Booth_Classic模块
   - 生成16个16位的部分积（pp0-pp15）和对应的符号位（S[15:0]）

2. **部分积压缩阶段**：
   - 将16个部分积输入到WallaceTree16X16模块
   - 通过6个压缩阶段，将部分积压缩为两个32位操作数（opa和opb）

3. **符号位补偿计算**：
   - 使用第一个CS_Adder32加法器计算符号位补偿向量

4. **临时结果计算**：
   - 使用第二个CS_Adder32加法器计算Wallace树输出的两个操作数之和

5. **最终结果计算**：
   - 使用第三个CS_Adder32加法器将临时结果与符号位补偿向量相加，得到最终结果

## 模块间接口设计

### TopMultiplier与Booth_Classic接口

- **输入**：
  - M[15:0]：16位被乘数
  - R[15:0]：16位乘数
- **输出**：
  - pp0[15:0] - pp15[15:0]：16个16位部分积
  - S[15:0]：部分积的符号位

### TopMultiplier与WallaceTree16X16接口

- **输入**：
  - pp0[15:0] - pp15[15:0]：来自Booth_Classic的16个部分积
- **输出**：
  - opa[31:0]、opb[31:0]：压缩后的两个32位操作数

### TopMultiplier与CS_Adder32接口

系统中共使用了三个CS_Adder32实例，分别用于：

1. **符号位补偿计算**：
   - 输入：a = {~sign, 16'b0}, b = {15'b0, 1'b1, 16'b0}, cin = 1'b0
   - 输出：sign_compensate[31:0]

2. **临时结果计算**：
   - 输入：a = opa[31:0], b = opb[31:0], cin = 1'b0
   - 输出：res_tmp[31:0]

3. **最终结果计算**：
   - 输入：a = res_tmp[31:0], b = sign_compensate[31:0], cin = 1'b0
   - 输出：result_out[31:0]

## 时序设计

本乘法器设计采用组合逻辑实现，不包含时序电路元素，因此所有计算在一个时钟周期内完成。这种设计虽然可能导致较长的关键路径延迟，但简化了控制逻辑，并且在中低频应用中具有较好的性能。

在实际应用中，可以根据时序要求，在系统各个关键节点添加流水线寄存器，以提高系统的工作频率。

## 设计优化考虑

1. **延迟优化**：
   - 采用Wallace树结构压缩部分积，减少加法器级联数量
   - 使用平方根进位选择加法器，优化进位传播延迟

2. **面积优化**：
   - 经典Booth算法实现简单，逻辑资源消耗较小
   - Wallace树虽然连接复杂，但使用的基本单元（半加器和全加器）结构简单

3. **功耗优化**：
   - 组合逻辑设计避免了时钟树功耗
   - 经过优化的关键路径可以减少信号抖动，降低动态功耗

## 可扩展性

本系统的模块化设计使其具有良好的可扩展性。通过适当修改参数和接口，可以：

1. 扩展为24x24位、32x32位等更大位宽的乘法器
2. 替换Booth算法为改进的Booth-2编码，减少部分积数量
3. 替换Wallace树为规则树结构，简化布局布线
4. 替换进位选择加法器为Kogge-Stone或Brent-Kung等并行前缀加法器

## 总结

本16X16乘法器的系统架构采用模块化设计，清晰划分功能模块，实现了从部分积生成到最终结果计算的完整流程。系统的设计充分考虑了性能优化、资源利用和可扩展性，是一个典型的数字系统设计实例。 